<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Pulse Code Converter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: #0f172a;
    color: #e2e8f0;
    padding: 20px;
    line-height: 1.6;
    min-height: 100vh;
    background-image: 
        radial-gradient(circle at 10% 20%, rgba(56, 189, 248, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.05) 0%, transparent 20%);
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}

header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #334155;
}

h1 {
    color: #38bdf8;
    margin-bottom: 10px;
    font-size: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
}

h1 i {
    font-size: 2.2rem;
}

.subtitle {
    color: #94a3b8;
    font-size: 1.1rem;
    max-width: 800px;
    margin: 0 auto;
}

.input-section {
    background-color: #1e293b;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    border: 1px solid #334155;
    transition: all 0.3s ease;
}

.input-section:hover {
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
}

.input-row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
}

.input-group {
    flex: 1;
    min-width: 250px;
}

label {
    display: block;
    margin-bottom: 8px;
    color: #cbd5e1;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

input, select {
    width: 100%;
    padding: 12px;
    background-color: #334155;
    border: 1px solid #475569;
    border-radius: 6px;
    color: #f8fafc;
    font-size: 1rem;
    transition: all 0.3s ease;
}

input:focus, select:focus {
    outline: none;
    border-color: #38bdf8;
    box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
}

.convert-btn {
    display: block;
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.convert-btn:hover {
    background: linear-gradient(135deg, #0284c7 0%, #2563eb 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(37, 99, 235, 0.3);
}

.convert-btn:active {
    transform: translateY(0);
}

.output-section {
    margin-top: 40px;
}

.output-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.section-title {
    color: #38bdf8;
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.code-selector {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 25px;
    border-bottom: 1px solid #334155;
    padding-bottom: 15px;
}

.code-tab {
    padding: 12px 24px;
    background-color: #334155;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    flex: 1;
    min-width: 180px;
    justify-content: center;
}

.code-tab:hover {
    background-color: #475569;
    transform: translateY(-2px);
}

.code-tab.active {
    background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
    color: white;
    box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
}

.pulse-display {
    background-color: #1e293b;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    border: 1px solid #334155;
    overflow-x: auto;
}

.pulse-title {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    color: #38bdf8;
    font-size: 1.4rem;
    flex-wrap: wrap;
    gap: 15px;
}

#bitCount {
    background-color: #334155;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 1rem;
    color: #cbd5e1;
}

.pulse-grid {
    display: flex;
    flex-wrap: nowrap;
    gap: 0;
    margin-top: 30px;
    padding: 15px;
    background-color: #0f172a;
    border-radius: 8px;
    min-height: 150px;
    overflow-x: auto;
    overflow-y: visible;
}

.char-group {
    display: flex;
    flex-direction: column;
    margin-right: 15px;
    padding: 10px;
    border-radius: 8px;
    transition: all 0.3s ease;
    position: relative;
}

.char-group:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3);
}

.char-group::before {
    content: attr(data-char);
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.1rem;
    font-weight: 600;
    color: #38bdf8;
    background-color: #1e293b;
    padding: 4px 12px;
    border-radius: 6px;
    border: 1px solid #334155;
    white-space: nowrap;
}

.char-group:nth-child(1) {
    background-color: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.char-group:nth-child(2) {
    background-color: rgba(251, 146, 60, 0.1);
    border: 1px solid rgba(251, 146, 60, 0.3);
}

.char-group:nth-child(3) {
    background-color: rgba(250, 204, 21, 0.1);
    border: 1px solid rgba(250, 204, 21, 0.3);
}

.char-group:nth-child(4) {
    background-color: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.3);
}

.char-group:nth-child(5) {
    background-color: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
}

.char-group:nth-child(6) {
    background-color: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.3);
}

.char-group:nth-child(7) {
    background-color: rgba(236, 72, 153, 0.1);
    border: 1px solid rgba(236, 72, 153, 0.3);
}

.char-group:nth-child(n+8) {
    background-color: rgba(148, 163, 184, 0.1);
    border: 1px solid rgba(148, 163, 184, 0.3);
}

.bits-row {
    display: flex;
    gap: 2px;
    margin-bottom: 8px;
}

.bit-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.3s ease;
}

.bit-container:hover {
    transform: translateY(-5px);
}

.bit-label {
    font-size: 0.75rem;
    color: #94a3b8;
    margin-top: 5px;
    text-align: center;
    min-height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(30, 41, 59, 0.7);
    padding: 4px 6px;
    border-radius: 4px;
    flex-direction: column;
    white-space: nowrap;
}

.bit-box {
    width: 45px;
    height: 45px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    border: 1px solid #475569;
    position: relative;
    background-color: #0f172a;
    border-radius: 4px;
    overflow: hidden;
}

.bit-cell {
    position: relative;
    border-right: 1px solid rgba(71, 85, 105, 0.3);
    border-bottom: 1px solid rgba(71, 85, 105, 0.3);
}

.bit-cell:nth-child(2n) {
    border-right: none;
}

.bit-cell:nth-child(n+3) {
    border-bottom: none;
}

.voltage-line {
    position: absolute;
    left: 0;
    right: 0;
    height: 3px;
    background-color: #38bdf8;
    z-index: 5;
}

.top-line {
    top: 25%;
    background-color: rgba(56, 189, 248, 0.3);
}

.middle-line {
    top: 50%;
    background-color: rgba(56, 189, 248, 0.3);
}

.bottom-line {
    top: 75%;
    background-color: rgba(56, 189, 248, 0.3);
}

.vertical-line {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 3px;
    background-color: #8b5cf6;
    z-index: 5;
}

.left-line {
    left: 25%;
    background-color: rgba(139, 92, 246, 0.3);
}

.center-line {
    left: 50%;
    background-color: rgba(139, 92, 246, 0.3);
}

.right-line {
    left: 75%;
    background-color: rgba(139, 92, 246, 0.3);
}

.conversion-steps {
    background-color: #1e293b;
    border-radius: 10px;
    padding: 25px;
    margin-top: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    border: 1px solid #334155;
}

.steps-title {
    color: #38bdf8;
    margin-bottom: 20px;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.step {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #334155;
    transition: all 0.3s ease;
    padding: 15px;
    border-radius: 6px;
}

.step:hover {
    background-color: rgba(30, 41, 59, 0.8);
}

.step:last-child {
    border-bottom: none;
}

.step-title {
    color: #cbd5e1;
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 1.1rem;
}

.step-content {
    color: #94a3b8;
    font-family: 'Courier New', monospace;
    background-color: #0f172a;
    padding: 10px;
    border-radius: 4px;
    overflow-x: auto;
    white-space: nowrap;
}

.legend {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
}

.legend-color {
    width: 20px;
    height: 3px;
}

.legend-color.high {
    background-color: #10b981;
}

.legend-color.zero {
    background-color: #f59e0b;
}

.legend-color.low {
    background-color: #ef4444;
}

.legend-color.timing {
    background-color: #8b5cf6;
    width: 3px;
    height: 20px;
}

.legend-text {
    font-size: 0.9rem;
    color: #94a3b8;
}

.pulse-description {
    margin-top: 15px;
    color: #94a3b8;
    font-style: italic;
    font-size: 0.95rem;
    padding: 12px;
    background-color: rgba(30, 41, 59, 0.7);
    border-radius: 6px;
    border-left: 4px solid #0ea5e9;
}

footer {
    margin-top: 40px;
    text-align: center;
    padding: 20px;
    color: #94a3b8;
    border-top: 1px solid #334155;
    font-size: 0.9rem;
}

.pulse-segment {
    position: absolute;
    z-index: 10;
    transition: all 0.3s ease;
}

.horizontal-pulse {
    height: 4px;
    left: 0;
    right: 0;
}

.vertical-pulse {
    width: 4px;
    top: 0;
    bottom: 0;
}

@media (max-width: 768px) {
    .input-row {
        flex-direction: column;
    }
    
    .code-selector {
        justify-content: center;
    }
    
    .code-tab {
        min-width: 150px;
    }
    
    .pulse-grid {
        justify-content: flex-start;
    }
    
    h1 {
        font-size: 2rem;
    }
    
    .pulse-title {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .bit-box {
        width: 40px;
        height: 40px;
    }
    
    .legend {
        gap: 15px;
    }
}

@media (max-width: 480px) {
    body {
        padding: 10px;
    }
    
    h1 {
        font-size: 1.8rem;
    }
    
    .code-tab {
        min-width: 100%;
    }
    
    .bit-box {
        width: 35px;
        height: 35px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-wave-square"></i> Digital Pulse Code Converter</h1>
            <p class="subtitle">Convert strings to digital pulse codes (NRZ, RZ, Manchester, Binary AMI, CMI) and visualize them in a 2x2 box format for each bit.</p>
        </header>
        
        <section class="input-section">
            <div class="input-row">
                <div class="input-group">
                    <label for="inputString"><i class="fas fa-font"></i> Enter Text to Encode</label>
                    <input type="text" id="inputString" value="Hello" placeholder="Enter text to convert to pulse codes">
                </div>
                
                <div class="input-group">
                    <label for="pulseType"><i class="fas fa-code"></i> Select Pulse Code Type</label>
                    <select id="pulseType">
                        <option value="NRZ">Non-Return to Zero (NRZ)</option>
                        <option value="RZ">Return to Zero (RZ)</option>
                        <option value="Manchester">Manchester</option>
                        <option value="AMI">Binary AMI</option>
                        <option value="CMI">Coded Mark Inversion (CMI)</option>
                    </select>
                </div>
            </div>
            
            <button id="convertBtn" class="convert-btn">
                <i class="fas fa-bolt"></i> Convert to Digital Pulse Code
            </button>
        </section>
        
        <section class="output-section">
            <div class="output-header">
                <h2 class="section-title"><i class="fas fa-eye"></i> Digital Pulse Code Visualization</h2>
            </div>
            
            <div class="code-selector" id="codeTabs">
                <div class="code-tab active" data-code="NRZ">
                    <i class="fas fa-minus"></i> Non-Return to Zero
                </div>
                <div class="code-tab" data-code="RZ">
                    <i class="fas fa-undo"></i> Return to Zero
                </div>
                <div class="code-tab" data-code="Manchester">
                    <i class="fas fa-exchange-alt"></i> Manchester
                </div>
                <div class="code-tab" data-code="AMI">
                    <i class="fas fa-random"></i> Binary AMI
                </div>
                <div class="code-tab" data-code="CMI">
                    <i class="fas fa-project-diagram"></i> CMI
                </div>
            </div>
            
            <div class="pulse-display">
                <div class="pulse-title">
                    <span id="currentCodeName">Non-Return to Zero (NRZ) Encoding</span>
                    <span id="bitCount">5 characters × 8 bits = 40 bits</span>
                </div>
                
                <div class="pulse-grid" id="pulseGrid">
                    <!-- Pulse code visualization will be generated here -->
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color high"></div>
                        <div class="legend-text">+5V (High)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color zero"></div>
                        <div class="legend-text">0V (Zero)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color low"></div>
                        <div class="legend-text">-5V (Low)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color timing"></div>
                        <div class="legend-text">Timing (Vertical)</div>
                    </div>
                </div>
                
                <p class="pulse-description" id="pulseDescription">
                    NRZ encoding: High level (+5V) represents '1', low level (-5V) represents '0'. No return to zero between consecutive bits.
                </p>
            </div>
        </section>
        
        <section class="conversion-steps">
            <h3 class="steps-title"><i class="fas fa-list-ol"></i> Conversion Process</h3>
            
            <div class="step">
                <div class="step-title">Step 1: String → Character Array</div>
                <div class="step-content" id="step1">"Hello" → ['H', 'e', 'l', 'l', 'o']</div>
            </div>
            
            <div class="step">
                <div class="step-title">Step 2: Character Array → ASCII Array</div>
                <div class="step-content" id="step2">'H' → 72, 'e' → 101, 'l' → 108, 'l' → 108, 'o' → 111</div>
            </div>
            
            <div class="step">
                <div class="step-title">Step 3: ASCII Array → Binary Array</div>
                <div class="step-content" id="step3">72 → 01001000, 101 → 01100101, 108 → 01101100, 108 → 01101100, 111 → 01101111</div>
            </div>
            
            <div class="step">
                <div class="step-title">Step 4: Binary Array → Digital Pulse Code</div>
                <div class="step-content" id="step4">Applying NRZ encoding to the binary sequence</div>
            </div>
        </section>
        
        <footer>
            <p>Digital Pulse Code Converter | Encoding Techniques Visualization</p>
        </footer>
    </div>

    <script>
// Pulse Code Converter Application
console.log("Script starting...");

// Pulse code descriptions
const codeDescriptions = {
    NRZ: "NRZ encoding: High level (+5V) represents '1', low level (-5V) represents '0'. No return to zero between consecutive bits.",
    RZ: "RZ encoding: High pulse (+5V) in first half represents '1', low pulse (-5V) in first half represents '0'. Always returns to zero in second half.",
    Manchester: "Manchester encoding: Transition from high to low represents '1', transition from low to high represents '0'. Each bit has a transition in the middle.",
    AMI: "Binary AMI encoding: '0' is represented by zero voltage. '1' is represented by alternating positive (+5V) and negative (-5V) pulses.",
    CMI: "CMI encoding: '0' is represented by a high level in first half and low in second half. '1' alternates between all high and all low."
};

// Pulse code full names
const codeNames = {
    NRZ: "Non-Return to Zero (NRZ) Encoding",
    RZ: "Return to Zero (RZ) Encoding",
    Manchester: "Manchester Encoding",
    AMI: "Binary AMI Encoding",
    CMI: "Coded Mark Inversion (CMI) Encoding"
};

// Main conversion function
function convertToPulseCode() {
    console.log("convertToPulseCode called");
    
    const inputString = document.getElementById('inputString');
    const pulseType = document.getElementById('pulseType');
    const pulseGrid = document.getElementById('pulseGrid');
    const currentCodeName = document.getElementById('currentCodeName');
    const bitCount = document.getElementById('bitCount');
    const pulseDescription = document.getElementById('pulseDescription');
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const step4 = document.getElementById('step4');
    
    console.log("Elements found:", {
        inputString: !!inputString,
        pulseType: !!pulseType,
        pulseGrid: !!pulseGrid
    });
    
    const text = inputString.value || "Hello";
    const codeType = pulseType.value;
    
    console.log("Converting:", text, "with", codeType);
    
    // Update UI
    currentCodeName.textContent = codeNames[codeType];
    pulseDescription.textContent = codeDescriptions[codeType];
    
    // Convert string to character array
    const charArray = text.split('');
    step1.textContent = `"${text}" → [${charArray.map(c => `'${c}'`).join(', ')}]`;
    
    // Convert character array to ASCII array
    const asciiArray = charArray.map(char => char.charCodeAt(0));
    step2.textContent = asciiArray.map((ascii, i) => `'${charArray[i]}' → ${ascii}`).join(', ');
    
    // Convert ASCII array to binary array
    const binaryArray = asciiArray.map(ascii => {
        let binary = ascii.toString(2);
        // Pad to 8 bits
        while (binary.length < 8) binary = '0' + binary;
        return binary;
    });
    step3.textContent = binaryArray.map((binary, i) => `${asciiArray[i]} → ${binary}`).join(', ');
    
    // Update bit count
    const totalBits = binaryArray.join('').length;
    const charCount = charArray.length;
    bitCount.textContent = `${charCount} character${charCount !== 1 ? 's' : ''} × 8 bits = ${totalBits} bits`;
    
    // Generate pulse code visualization
    generatePulseVisualization(binaryArray, charArray, codeType, pulseGrid);
    
    // Update step 4 description
    step4.textContent = `Applying ${codeNames[codeType].split(' ')[0]} encoding to the binary sequence`;
}

// Generate pulse visualization with character grouping
function generatePulseVisualization(binaryArray, charArray, codeType, pulseGrid) {
    console.log("generatePulseVisualization called");
    console.log("binaryArray:", binaryArray);
    console.log("charArray:", charArray);
    
    // Clear previous visualization
    pulseGrid.innerHTML = '';
    
    // State variables for encodings that need memory
    let amiLastPolarity = 1; // 1 for positive, -1 for negative
    let cmiLastOne = 1; // 1 for high-high, -1 for low-low
    
    // Create a group for each character
    binaryArray.forEach((binaryString, charIndex) => {
        const char = charArray[charIndex];
        const charGroup = document.createElement('div');
        charGroup.className = 'char-group';
        charGroup.setAttribute('data-char', `Char ${charIndex + 1}: '${char}'`);
        
        console.log(`Creating group for character ${charIndex}: ${char}`);
        
        // Create bits row container
        const bitsRow = document.createElement('div');
        bitsRow.className = 'bits-row';
        
        // Create visualization for each bit in the character
        for (let bitInChar = 0; bitInChar < 8; bitInChar++) {
            const bit = binaryString[bitInChar];
            const globalBitIndex = charIndex * 8 + bitInChar;
            
            // Create bit container
            const bitContainer = document.createElement('div');
            bitContainer.className = 'bit-container';
            
            // Create 2x2 box for the bit
            const bitBox = createBitBox(globalBitIndex);
            bitContainer.appendChild(bitBox);
            
            // Create bit label (below the box)
            const bitLabel = document.createElement('div');
            bitLabel.className = 'bit-label';
            bitLabel.innerHTML = `<span>Bit ${bitInChar + 1}</span><span>(${bit})</span>`;
            bitContainer.appendChild(bitLabel);
            
            bitsRow.appendChild(bitContainer);
            
            // Draw the pulse lines based on encoding type
            setTimeout(() => {
                drawPulseLines(globalBitIndex, bit, codeType, amiLastPolarity, cmiLastOne);
            }, 0);
            
            // Update state for encodings that need it
            if (codeType === 'AMI' && bit === '1') {
                amiLastPolarity *= -1; // Alternate polarity
            }
            
            if (codeType === 'CMI' && bit === '1') {
                cmiLastOne *= -1; // Alternate for consecutive 1s
            }
        }
        
        charGroup.appendChild(bitsRow);
        pulseGrid.appendChild(charGroup);
    });
    
    console.log("Pulse grid children:", pulseGrid.children.length);
}

// Create 2x2 bit box
function createBitBox(index) {
    const bitBox = document.createElement('div');
    bitBox.className = 'bit-box';
    bitBox.id = `bit-${index}`;
    
    // Create the four cells of the 2x2 grid
    for (let cell = 0; cell < 4; cell++) {
        const cellDiv = document.createElement('div');
        cellDiv.className = 'bit-cell';
        cellDiv.id = `bit-${index}-cell-${cell}`;
        bitBox.appendChild(cellDiv);
    }
    
    return bitBox;
}

// Draw pulse lines for a specific bit
function drawPulseLines(bitIndex, bitValue, encoding, amiLastPolarity, cmiLastOne) {
    const bitBox = document.getElementById(`bit-${bitIndex}`);
    
    if (!bitBox) {
        console.error("Bit box not found:", bitIndex);
        return;
    }
    
    // Clear any existing lines
    const existingLines = bitBox.querySelectorAll('.pulse-segment');
    existingLines.forEach(line => line.remove());
    
    // Draw reference lines
    drawReferenceLines(bitBox);
    
    // Draw the actual pulse based on encoding type
    switch(encoding) {
        case 'NRZ':
            drawNRZ(bitBox, bitValue);
            break;
        case 'RZ':
            drawRZ(bitBox, bitValue);
            break;
        case 'Manchester':
            drawManchester(bitBox, bitValue);
            break;
        case 'AMI':
            drawAMI(bitBox, bitValue, amiLastPolarity);
            break;
        case 'CMI':
            drawCMI(bitBox, bitValue, cmiLastOne);
            break;
    }
}

// Draw reference lines (grid)
function drawReferenceLines(bitBox) {
    // Draw horizontal reference lines (top, middle, bottom)
    const horizontalPositions = ['25%', '50%', '75%'];
    horizontalPositions.forEach(pos => {
        const line = document.createElement('div');
        line.className = `voltage-line ${pos === '25%' ? 'top-line' : pos === '50%' ? 'middle-line' : 'bottom-line'}`;
        line.style.top = pos;
        bitBox.appendChild(line);
    });
    
    // Draw vertical reference lines (left, center, right)
    const verticalPositions = ['25%', '50%', '75%'];
    verticalPositions.forEach(pos => {
        const line = document.createElement('div');
        line.className = `vertical-line ${pos === '25%' ? 'left-line' : pos === '50%' ? 'center-line' : 'right-line'}`;
        line.style.left = pos;
        bitBox.appendChild(line);
    });
}

// Helper function to create a horizontal pulse segment
function createHorizontalPulse(bitBox, leftPercent, rightPercent, voltageLevel) {
    const pulse = document.createElement('div');
    pulse.className = 'pulse-segment horizontal-pulse';
    pulse.style.left = `${leftPercent}%`;
    pulse.style.right = `${100 - rightPercent}%`;
    
    // Set vertical position and color based on voltage
    if (voltageLevel === 1) {
        pulse.style.top = '25%'; // +5V
        pulse.style.backgroundColor = '#10b981'; // Green for high
    } else if (voltageLevel === 0) {
        pulse.style.top = '50%'; // 0V
        pulse.style.backgroundColor = '#f59e0b'; // Amber for zero
    } else if (voltageLevel === -1) {
        pulse.style.top = '75%'; // -5V
        pulse.style.backgroundColor = '#ef4444'; // Red for low
    }
    
    bitBox.appendChild(pulse);
    return pulse;
}

// Helper function to create a vertical pulse segment
function createVerticalPulse(bitBox, topPercent, bottomPercent, horizontalPosition) {
    const pulse = document.createElement('div');
    pulse.className = 'pulse-segment vertical-pulse';
    pulse.style.top = `${topPercent}%`;
    pulse.style.bottom = `${100 - bottomPercent}%`;
    
    // Set horizontal position
    if (horizontalPosition === 'left') {
        pulse.style.left = '25%';
    } else if (horizontalPosition === 'center') {
        pulse.style.left = '50%';
    } else if (horizontalPosition === 'right') {
        pulse.style.left = '75%';
    }
    
    pulse.style.backgroundColor = '#8b5cf6'; // Purple for vertical segments
    
    bitBox.appendChild(pulse);
    return pulse;
}

// NRZ encoding: high for 1, low for 0, constant throughout bit
function drawNRZ(bitBox, bit) {
    const voltage = bit === '1' ? 1 : -1;
    createHorizontalPulse(bitBox, 0, 100, voltage);
}

// RZ encoding: pulse in first half, zero in second half
function drawRZ(bitBox, bit) {
    const voltage = bit === '1' ? 1 : -1;
    createHorizontalPulse(bitBox, 0, 50, voltage); // First half
    createHorizontalPulse(bitBox, 50, 100, 0); // Second half (zero)
    
    // Vertical line at the center
    createVerticalPulse(bitBox, 0, 100, 'center');
}

// Manchester encoding: transition in the middle
function drawManchester(bitBox, bit) {
    if (bit === '1') {
        // High to low transition
        createHorizontalPulse(bitBox, 0, 50, 1); // First half high
        createHorizontalPulse(bitBox, 50, 100, -1); // Second half low
    } else {
        // Low to high transition
        createHorizontalPulse(bitBox, 0, 50, -1); // First half low
        createHorizontalPulse(bitBox, 50, 100, 1); // Second half high
    }
    
    // Vertical line at the center
    createVerticalPulse(bitBox, 0, 100, 'center');
}

// AMI encoding: alternating polarity for 1s, zero for 0s
function drawAMI(bitBox, bit, lastPolarity) {
    if (bit === '1') {
        // Use the current polarity
        createHorizontalPulse(bitBox, 0, 100, lastPolarity);
    } else {
        // Zero for 0 bits
        createHorizontalPulse(bitBox, 0, 100, 0);
    }
}

// CMI encoding
function drawCMI(bitBox, bit, lastOne) {
    if (bit === '1') {
        // For 1: alternate between all high and all low
        createHorizontalPulse(bitBox, 0, 100, lastOne);
    } else {
        // For 0: high in first half, low in second half
        createHorizontalPulse(bitBox, 0, 50, 1); // First half high
        createHorizontalPulse(bitBox, 50, 100, -1); // Second half low
        
        // Vertical line at the center
        createVerticalPulse(bitBox, 0, 100, 'center');
    }
}

// Initialize with default conversion
document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM Content Loaded");
    
    const convertBtn = document.getElementById('convertBtn');
    const codeTabs = document.getElementById('codeTabs');
    const pulseType = document.getElementById('pulseType');
    
    // Initial conversion
    convertToPulseCode();
    
    // Add event listeners
    convertBtn.addEventListener('click', function() {
        console.log("Convert button clicked");
        convertToPulseCode();
    });
    
    // Tab click events
    codeTabs.addEventListener('click', function(e) {
        if (e.target.classList.contains('code-tab')) {
            console.log("Tab clicked:", e.target.dataset.code);
            // Update active tab
            document.querySelectorAll('.code-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Update pulse type dropdown
            pulseType.value = e.target.dataset.code;
            
            // Convert with new pulse type
            convertToPulseCode();
        }
    });
    
    // Pulse type dropdown change event
    pulseType.addEventListener('change', function() {
        console.log("Dropdown changed:", pulseType.value);
        // Update active tab
        document.querySelectorAll('.code-tab').forEach(tab => {
            tab.classList.remove('active');
            if (tab.dataset.code === pulseType.value) {
                tab.classList.add('active');
            }
        });
        
        // Convert with new pulse type
        convertToPulseCode();
    });
    
    // Add keyboard shortcut (Ctrl+Enter to convert)
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            convertToPulseCode();
        }
    });
    
    console.log("Event listeners attached");
});

console.log("Script loaded successfully");
    </script>
</body>
</html>